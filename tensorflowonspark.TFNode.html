<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tensorflowonspark.TFNode module &mdash; TensorFlowOnSpark 2.2.5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="tensorflowonspark.TFParallel module" href="tensorflowonspark.TFParallel.html" />
    <link rel="prev" title="tensorflowonspark.TFManager module" href="tensorflowonspark.TFManager.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TensorFlowOnSpark
          </a>
              <div class="version">
                2.2.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tensorflowonspark.html">tensorflowonspark package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="tensorflowonspark.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.TFCluster.html">tensorflowonspark.TFCluster module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.TFManager.html">tensorflowonspark.TFManager module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">tensorflowonspark.TFNode module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.TFParallel.html">tensorflowonspark.TFParallel module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.TFSparkNode.html">tensorflowonspark.TFSparkNode module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.dfutil.html">tensorflowonspark.dfutil module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.gpu_info.html">tensorflowonspark.gpu_info module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.marker.html">tensorflowonspark.marker module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.pipeline.html">tensorflowonspark.pipeline module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.reservation.html">tensorflowonspark.reservation module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.reservation_client.html">tensorflowonspark.reservation_client module</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflowonspark.util.html">tensorflowonspark.util module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TensorFlowOnSpark</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tensorflowonspark.html">tensorflowonspark package</a> &raquo;</li>
      <li>tensorflowonspark.TFNode module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tensorflowonspark.TFNode.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-tensorflowonspark.TFNode">
<span id="tensorflowonspark-tfnode-module"></span><h1>tensorflowonspark.TFNode module<a class="headerlink" href="#module-tensorflowonspark.TFNode" title="Permalink to this headline"></a></h1>
<p>This module provides helper functions for the TensorFlow application.</p>
<p>Primarily, these functions help with:</p>
<ul class="simple">
<li><p>starting the TensorFlow <code class="docutils literal notranslate"><span class="pre">tf.train.Server</span></code> for the node (allocating GPUs as desired, and determining the node’s role in the cluster).</p></li>
<li><p>managing input/output data for <em>InputMode.SPARK</em>.</p></li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.DataFeed">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">DataFeed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qname_in</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'input'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qname_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'output'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#DataFeed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.DataFeed" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class manages the <em>InputMode.SPARK</em> data feeding process from the perspective of the TensorFlow application.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">mgr</dt>
<dd class="field-odd"><p>TFManager instance associated with this Python worker process.</p>
</dd>
<dt class="field-even">train_mode</dt>
<dd class="field-even"><p>boolean indicating if the data feed is expecting an output response (e.g. inferencing).</p>
</dd>
<dt class="field-odd">qname_in</dt>
<dd class="field-odd"><p><em>INTERNAL_USE</em></p>
</dd>
<dt class="field-even">qname_out</dt>
<dd class="field-even"><p><em>INTERNAL_USE</em></p>
</dd>
<dt class="field-odd">input_mapping</dt>
<dd class="field-odd"><p><em>For Spark ML Pipelines only</em>.  Dictionary of input DataFrame columns to input TensorFlow tensors.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.DataFeed.batch_results">
<span class="sig-name descname"><span class="pre">batch_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#DataFeed.batch_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.DataFeed.batch_results" title="Permalink to this definition"></a></dt>
<dd><p>Push a batch of output results to the Spark output RDD of <code class="docutils literal notranslate"><span class="pre">TFCluster.inference()</span></code>.</p>
<p>Note: this currently expects a one-to-one mapping of input to output data, so the length of the <code class="docutils literal notranslate"><span class="pre">results</span></code> array should match the length of
the previously retrieved batch of input data.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">results</dt>
<dd class="field-odd"><p>array of output data for the equivalent batch of input data.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.DataFeed.next_batch">
<span class="sig-name descname"><span class="pre">next_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#DataFeed.next_batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.DataFeed.next_batch" title="Permalink to this definition"></a></dt>
<dd><p>Gets a batch of items from the input RDD.</p>
<p>If multiple tensors are provided per row in the input RDD, e.g. tuple of (tensor1, tensor2, …, tensorN) and:</p>
<ul class="simple">
<li><p>no <code class="docutils literal notranslate"><span class="pre">input_mapping</span></code> was provided to the DataFeed constructor, this will return an array of <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> tuples,
and the caller is responsible for separating the tensors.</p></li>
<li><p>an <code class="docutils literal notranslate"><span class="pre">input_mapping</span></code> was provided to the DataFeed constructor, this will return a dictionary of N tensors,
with tensor names as keys and arrays of length <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> as values.</p></li>
</ul>
<p>Note: if the end of the data is reached, this may return with fewer than <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> items.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">batch_size</dt>
<dd class="field-odd"><p>number of items to retrieve.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>A batch of items or a dictionary of tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.DataFeed.should_stop">
<span class="sig-name descname"><span class="pre">should_stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#DataFeed.should_stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.DataFeed.should_stop" title="Permalink to this definition"></a></dt>
<dd><p>Check if the feed process was told to stop (by a call to <code class="docutils literal notranslate"><span class="pre">terminate</span></code>).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.DataFeed.terminate">
<span class="sig-name descname"><span class="pre">terminate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#DataFeed.terminate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.DataFeed.terminate" title="Permalink to this definition"></a></dt>
<dd><p>Terminate data feeding early.</p>
<p>Since TensorFlow applications can often terminate on conditions unrelated to the training data (e.g. steps, accuracy, etc),
this method signals the data feeding process to ignore any further incoming data.  Note that Spark itself does not have a mechanism
to terminate an RDD operation early, so the extra partitions will still be sent to the executors (but will be ignored).  Because
of this, you should size your input data accordingly to avoid excessive overhead.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.batch_results">
<span class="sig-name descname"><span class="pre">batch_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'output'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#batch_results"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.batch_results" title="Permalink to this definition"></a></dt>
<dd><p><em>DEPRECATED</em>. Use TFNode.DataFeed class instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.export_saved_model">
<span class="sig-name descname"><span class="pre">export_saved_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">export_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag_set</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signatures</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#export_saved_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.export_saved_model" title="Permalink to this definition"></a></dt>
<dd><p>Convenience function to export a saved_model using provided arguments</p>
<p>The caller specifies the saved_model signatures in a simplified python dictionary form, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">signatures</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;signature_def_key&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;input_tensor_alias&#39;</span><span class="p">:</span> <span class="n">input_tensor_name</span> <span class="p">},</span>
    <span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;output_tensor_alias&#39;</span><span class="p">:</span> <span class="n">output_tensor_name</span> <span class="p">},</span>
    <span class="s1">&#39;method_name&#39;</span><span class="p">:</span> <span class="s1">&#39;method&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And this function will generate the <cite>signature_def_map</cite> and export the saved_model.</p>
<p>DEPRECATED for TensorFlow 2.x+.</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">sess</dt>
<dd class="field-odd"><p>a tf.Session instance</p>
</dd>
<dt class="field-even">export_dir</dt>
<dd class="field-even"><p>path to save exported saved_model</p>
</dd>
<dt class="field-odd">tag_set</dt>
<dd class="field-odd"><p>string tag_set to identify the exported graph</p>
</dd>
<dt class="field-even">signatures</dt>
<dd class="field-even"><p>simplified dictionary representation of a TensorFlow signature_def_map</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>A saved_model exported to disk at <code class="docutils literal notranslate"><span class="pre">export_dir</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.hdfs_path">
<span class="sig-name descname"><span class="pre">hdfs_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#hdfs_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.hdfs_path" title="Permalink to this definition"></a></dt>
<dd><p>Convenience function to create a Tensorflow-compatible absolute HDFS path from relative paths</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">ctx</dt>
<dd class="field-odd"><p>TFNodeContext containing the metadata specific to this node in the cluster.</p>
</dd>
<dt class="field-even">path</dt>
<dd class="field-even"><p>path to convert</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>An absolute path prefixed with the correct filesystem scheme.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.next_batch">
<span class="sig-name descname"><span class="pre">next_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'input'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#next_batch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.next_batch" title="Permalink to this definition"></a></dt>
<dd><p><em>DEPRECATED</em>. Use TFNode.DataFeed class instead.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.release_port">
<span class="sig-name descname"><span class="pre">release_port</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#release_port"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.release_port" title="Permalink to this definition"></a></dt>
<dd><p>Closes the temporary socket created to assign a port to the TF node.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.start_cluster_server">
<span class="sig-name descname"><span class="pre">start_cluster_server</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_gpus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rdma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#start_cluster_server"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.start_cluster_server" title="Permalink to this definition"></a></dt>
<dd><p>Function that wraps the creation of TensorFlow <code class="docutils literal notranslate"><span class="pre">tf.train.Server</span></code> for a node in a distributed TensorFlow cluster.</p>
<p>This is intended to be invoked from within the TF <code class="docutils literal notranslate"><span class="pre">map_fun</span></code>, replacing explicit code to instantiate <code class="docutils literal notranslate"><span class="pre">tf.train.ClusterSpec</span></code>
and <code class="docutils literal notranslate"><span class="pre">tf.train.Server</span></code> objects.</p>
<p>DEPRECATED for TensorFlow 2.x+</p>
<dl class="simple">
<dt>Args:</dt><dd><dl class="field-list simple">
<dt class="field-odd">ctx</dt>
<dd class="field-odd"><p>TFNodeContext containing the metadata specific to this node in the cluster.</p>
</dd>
<dt class="field-even">num_gpu</dt>
<dd class="field-even"><p>number of GPUs desired</p>
</dd>
<dt class="field-odd">rdma</dt>
<dd class="field-odd"><p>boolean indicating if RDMA ‘iverbs’ should be used for cluster communications.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><p>A tuple of (cluster_spec, server)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tensorflowonspark.TFNode.terminate">
<span class="sig-name descname"><span class="pre">terminate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'input'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tensorflowonspark/TFNode.html#terminate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tensorflowonspark.TFNode.terminate" title="Permalink to this definition"></a></dt>
<dd><p><em>DEPRECATED</em>. Use TFNode.DataFeed class instead.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tensorflowonspark.TFManager.html" class="btn btn-neutral float-left" title="tensorflowonspark.TFManager module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tensorflowonspark.TFParallel.html" class="btn btn-neutral float-right" title="tensorflowonspark.TFParallel module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Yahoo Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>